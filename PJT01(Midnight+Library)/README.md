# project | Midnight Library
> AI 기반 도서 창작 지원 서비스 및 사용자 맞춤 도서 추천 웹 사이트 개발

## 목차

- (기확과 설계) 프로젝트 정의 및 목표 
  - 어떤 프로젝트인지?
  - 무엇을 목표로 하였는지?

- 기능 구현 과정 (키워드 기반 추천 알고리즘, 생성형 AI 활용한 독후감 작성)
  - 목적 
  - 문제점
  - 해결방안
  - 개선방향

- 프로젝트 전반적인 결론
  - 아쉬웠던 점
  - 개선할 점 (기능적, 진행과정, 기획 과정 등)
  - 배운 점


### 목표 서비스 및 실제 구현 정도

  ## 성공

  1. 핵심 키워드 기반 도서 유사도 추천 알고리즘 구현하기

      DB에 저장된 도서 데이터의 상세 도서 소개글을 활용하여 콘텐츠 기반 추천 알고리즘을 구현하였다. 

      사용자가 좋아요 한 책을 기반으로 코사인 유사도를 계산하여 추찬하고, 읽었다고 등록한 책을 기반으로도 책을 추천한다.


  2. 생성형 AI 활용하여 자동으로 독후감 작성

      책을 읽으며 메모한 인용구, 짧은 생각 등을 저장한 데이터를 바탕으로 생성형 AI 가 대신 독후감을 작성해주는 기능을 구현하였다.

  3. 지도 API를 활용하여 사용자 위치 주위의 서점을 검색할 수 있는 기능 구현

  ## 실패 사례

  1. 팔로우 기반 협업 필터링을 구현하고 싶었으나 기술적 어려움과 시간 부족으로 구현하지 못하였다.

  2. 사용자의 데이터를 얻을 수 있는 퀴즈 형식의 설문조사로 맞춤형 추천 알고리즘을 구현하고 싶었지만 기술적 어려움과 시간 부족으로 구현하지 못하였다.

### 3. 데이터베이스 모델링

    ## 📘 데이터베이스 ERD

      아래는 프로젝트에서 사용한 데이터베이스 ERD(Entity Relationship Diagram)입니다:

      ![ERD](./assets/erd.png)


      (1) Book : 알라딘 API 도서 데이터 DB 저장용

      (2) BookVector : 키워드 벡터 저장

      (3) Category : 알라딘 API에서 분류된 카테고리의 2Depth를 기준으로 추출하여 총 514개의 카테고리를 20개의 유사한 카테고리로 그룹화

      (4) Book_Save : 내가 읽고 등록한 도서

        => DB에 없는 도서를 등록할 수도 있어서 생성함

      (5) Book_Memo : 도서와 관련된 간단한 메모 작성 DB

      (6) BookArticle : 도서에 대한 리뷰 작성 DB

      (7) Comment : 리뷰에 대한 댓글 작성

      (8) Book_likes : 좋아요 한 도서

      (9) User : 사이트 회원 정보

      (10) User_followings : 팔로잉 / 팔로우 DB 


### 4. 도서 추천 알고리즘에 대한 기술적 설명
  1. 베스트 셀러: 도서관 정보나루 API 에서 최근 한달 간 인기 도서 조회 후 30권 추출
  2. 연령 별: 도서관 정보나루 API 에서 최근 3개월 간 연령 별 인기 도서 조회 후 20권 추출
    - 도서관 정보나루 API 요청 구현
      - 요청 파라미터: authKey, age, startDt, endDt, format(json), pageSize를 back/books/views.py에 구현 후 요청
      - 회원가입 시 stores/accounts의 accountStore를 통해 로그인 한 사용자의 정보 저장
        - userInfo.age를 가져와서 연령 숫자를 보여주고, API 요청 파라미터에 추가
  3. 관심 장르별: DB에 저장되어 있는 Book 테이블에서 category가 같은 책 5권 추출
    - 사용자가 가입 시 선택한 관심 장르들은 Category 테이블과 ManyToMany로 연결됨
    - 회원가입 시 FormData로 interested_genre 배열을 전달받아 저장됨
  4. 일정 기반: 달력에 입력된 일정에서 키워드를 추출하여 도서관 정보나루 API 에서 키워드 기반 도서 조회 후 5권 추출
    - 저장된 일정은 백엔드 DB에 Calendar 모델로 저장되며, 프론트엔드 schedules와 calendarList 상태에도 반영됨 (일정 삭제 가능)
    - 선택된 날짜(selectedDate) 만 전달해 해당 날짜에 맞는 책만 추천 
  5. 좋아요 기반 / 등록된 도서 기반
    - 책 소개 글 기반 키워드 및 score 추출
    - TF-IDF 벡터 생성
    - 코사인 유사도 계산 후 상위 5권 추천 


### 5. 핵심 기능 설명
  1. 메인 페이지
    - 비로그인 시
      - 베스트셀러 Top 30 추천
      - 게시글 목록 확인
      - Map 에서 주변 서점 검색
    - 로그인 시 
      - 비로그인 상태의 모든 기능
      - 회원가입할 때 입력받은 연령, 관심 장르 바탕으로 관련 도서 추천
        - 연령: 도서관 정보나루 API 로 연령기반 추천 도서 데이터 활용
        - 관심 장르: DB에 저장되어 있는 알라딘 데이터를 20개의 장르로 분류 후 해당하는 장르 내 도서 추천
      - 도서 목록에서 좋아요 한 책 기반 추천 
        - 좋아요 한 책의 정보와 설명에서 키워드를 추출한 후 DB에 저장되어 있는 책 목록 중 유사도 순으로 추천
      - 달력 일정 기반 추천
        - 달력에 일정을 입력하면 일정과 관련된 도서 추천 (예: 오픽 -> '오픽노잼' 문제집 추천)
        - 도서관 정보나루 API 로 키워드 추출 도서 데이터 활용
      - 게시글 상세 정보 확인
    
  2. 도서 검색 페이지
    - 전체 도서 검색
      - 제목, 작가 정보로 검색 가능
      - 장르 별로 저장되어 있는 도서 제공
    - 도서 상세 페이지
      - 각 책 별 상세 정보(작가, 출판사, 리뷰 평점, 책 소개)
      - 사용자가 누른 좋아요 수 
      - 좋아요 / 마이페이지의 내 서재에 등록 가능
      - 해당 도서로 게시글을 썼다면 목록 확인 가능
  
  3. 마이 페이지
    - 내 프로필 정보 확인 가능
      - 읽은 책 권 수, 팔로워/팔로잉
    - 도서 등록 기능
      - DB에 저장되어 있는 알라딘 도서 데이터 검색 후 등록을 통해 내가 읽은 / 읽고 있는 도서라고 표시
      - 등록한 도서 목록
        - 메모 작성 기능 (도서 읽는 도중 언제든 추가 가능)
        - 리뷰(게시글) 생성
      - 내가 작성한 게시글 목록
      - 내가 좋아요 한 책 목록
      - 내가 등록한 도서 목록 기반 추천
        - 키워드 추출 후 DB에 저장되어 있는 책 목록 중 유사도 순으로 추천
  
  4. 메모
    - 게시글(리뷰)는 도서를 다 읽고 난 후 작성하는 것
    - 메모는 도서를 읽는 도중 언제든 추가 작성 가능
    - 책을 읽는 도중 기억하고 싶은 문구나 느낀점 기록
  
  5. 게시글(리뷰) 작성 페이지
    - 제목, 내용, 읽은 날짜, 평점
    - 메모의 문구, 느낀점, 책 제목, 작가를 바탕으로 생성형 AI가 자동으로 게시글(리뷰) 작성
    - 직접 게시글 내용 작성도 가능
  
  6. 게시글 상세 페이지
    - 게시글 작성자, 작성일, 수정일, 평점 확인
    - 게시글 수정, 삭세, 좋아요
    - 댓글 게시, 수정, 삭제, 댓글 개수


### 6. 생성형 AI를 활용한 부분
  - 사용자가 책을 읽으며 기록한 메모를 바탕으로 OpenAI의 GPT API를 호출하여 자동으로 독후감 생성
  - 프롬프트:     
  prompt = f"""
  당신은 사용자가 읽은 책에 대한 독서 감상문을 도와주는 작가입니다.

  다음은 책에 대한 정보입니다.
  - 제목: {book.title}
  - 저자: {book.author}

  그리고 사용자가 이 책을 읽는 동안 작성한 메모는 다음과 같습니다:

  {combined_memo}

  이 정보를 바탕으로 진정성 있는 독서 감상문을 작성해 주세요. 너무 기계적으로 쓰지 말고 감정을 담아주세요.
  """
  - 마이페이지에서 사용자가 작성한 메모가 django의 BookMemo에 저장됨
  - Django 뷰에서는 해당 책 ID와 유저 정보를 기반으로, 해당 유저가 작성한 모든 메모를 DB에서 불러와서 하나의 문자열로 합침
  - 이후 책 제목, 저자 정보까지 포함하여 하나의 프롬프트 구성
  - client.chat.completions.create() 함수로 GPT에 프롬프트를 전달
  - 응답으로 받은 감상문 텍스트는 독후감 content의 textarea에 자동으로 채워짐
  - 사용자는 이 결과를 바탕으로 수정하거나 그대로 게시글을 생성할 수 있음

  ### 7. 기타 (느낀점, 후기)

    1. 사이트 설계부터 어렵다.

        DB와 컴포넌트 구성을 꼼꼼하게 하는 것부터 어려웠다.

        협업하는 과정에서 같은 페이지에 활용하는 컴포넌트를 통일시키지 않아서 디버깅이 어려웠따. 

    2. 피니아를 활용한 변수 관리가 힘들다.

        피니아를 통해 전역 변수로 관리할 경우, 변화를 실시간 감시해줘야 하는 어려움이 있었다. 이 부분이 페이지 렌더링을 효율적으로 하는 것인지는 모르겠지만, 정신 똑바로 차리고 있지 않으면 데이터를 불러오지 않거나 엉뚱한 데이터를 가지고 있는 경우가 많았다.

        특히, 좋아요 팔로우 / 팔로잉 기능 구현할 때 user를 구분 지을 수 있어야 했다.

    3. 데이터를 수집하고 정제하는 과정이 까다롭다.

        챗GPT에게 514개의 카테고리를 20개의 유사한 카테고리로 재분류 해달라고 하였으나 엉뚱한 곳에 분류를 하거나 분류하지 않고 빠트리는 경우가 많았다. 그래서 결국 어느 정도 수작업이 필요했다. 

    4. AI가 짜주는 코드를 맹신하면 안된다.

        GPT가 주는 코드를 그대로 붙여넣기 하면 나중에 다른 코드와 충돌이 있을 때 원인을 못 찾을 수 있다. 따라서 내가 이해할 수 있는 코드를 사용해야 한다. 또한 무작정 '~ 코드 짜줘' 라고 하는 것보다 구체적인 로직과 사용할 함수를 제공할 때 제대로 된 코드를 짜준다. 따라서 생성형 AI를 사용하는 사람이 프로그래밍 언어를 이해하고 있는 것은 매우 중요하다.

        팔로워 기능 구현 할 때 새로고침 하지 않으면 데이터가 바뀌지 않는 현상이 있었다. 챗 GPT 는 aync 와 await 라는 모르는 방법을 알려줬지만 watch 로 params를 감시하고 바뀔 때마다 user 정보를 불러오는 함수를 호출했더니 제대로 동작했다. 
    
        ![image.png](attachment:641d6573-bb32-464e-af42-0aae24236676:image.png)
        
        모르는 상태에서 질문하는 것보다 아는 상태에서 질문할 때 더 효율적으로 사용 가능!!!